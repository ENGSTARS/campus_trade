import{r as i,j as e,B as g,C as E,a as T,b as D,T as L,u as O,c as I,d as k,e as A,N as M,m as _}from"./index-B1S_F-6_.js";import{I as h}from"./Input-DYW_1lTB.js";import{E as F}from"./ErrorState-1quVR8lb.js";import{S as d}from"./Select-ysVb1C2v.js";import{L as R}from"./ListingsGrid-Dn_bB85M.js";import"./ListingCard-DHoE9UHn.js";import"./Badge-C6W-SCl_.js";import"./Card-DAcoRpIw.js";import"./listingPermissions-auyDyiec.js";import"./Skeleton-BK5u2klB.js";import"./EmptyState-CYPOGT4r.js";function z(t,a=350){const[n,s]=i.useState(t);return i.useEffect(()=>{const l=setTimeout(()=>s(t),a);return()=>clearTimeout(l)},[t,a]),n}function B(t=[],a=1,n=8){const s=Math.max(1,Math.ceil(t.length/n)),l=Math.min(Math.max(a,1),s),r=i.useMemo(()=>{const o=(l-1)*n;return t.slice(o,o+n)},[t,n,l]);return{totalPages:s,safePage:l,paginatedItems:r}}function G({value:t,onChange:a}){return e.jsxs("div",{className:"relative w-full",children:[e.jsx("span",{className:"pointer-events-none absolute left-3 top-[34px] z-10 rounded-md bg-brand-50 px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide text-brand-700",children:"Search"}),e.jsx(h,{value:t,className:"pl-[84px]",onChange:n=>a(n.target.value),placeholder:"Search books, electronics, furniture...","aria-label":"Search listings"})]})}function H({currentPage:t,totalPages:a,onPageChange:n}){return a<=1?null:e.jsxs("div",{className:"mt-5 flex items-center justify-center gap-2 rounded-2xl border border-brand-100/80 bg-white/80 p-2",children:[e.jsx(g,{variant:"secondary",size:"sm",disabled:t===1,onClick:()=>n(t-1),children:"Previous"}),e.jsxs("span",{className:"rounded-lg bg-brand-50 px-3 py-2 text-sm font-semibold text-brand-700",children:["Page ",t," of ",a]}),e.jsx(g,{variant:"secondary",size:"sm",disabled:t===a,onClick:()=>n(t+1),children:"Next"})]})}function U({filters:t,onChange:a,onReset:n}){return e.jsxs("aside",{className:"card-surface h-fit space-y-4 p-4 lg:sticky lg:top-24",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-display text-sm font-semibold text-slate-900",children:"Filters"}),e.jsx(g,{variant:"ghost",size:"sm",onClick:n,children:"Reset"})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Refine by campus, category, condition, type, and budget."}),e.jsx(d,{label:"Campus",value:t.campus,onChange:s=>a({campus:s.target.value}),options:[{value:"all",label:"All campuses"},...E.map(s=>({value:s,label:s}))]}),e.jsx(d,{label:"Category",value:t.category,onChange:s=>a({category:s.target.value}),options:[{value:"all",label:"All categories"},...T.map(s=>({value:s,label:s}))]}),e.jsx(d,{label:"Condition",value:t.condition,onChange:s=>a({condition:s.target.value}),options:[{value:"all",label:"All conditions"},...D.map(s=>({value:s,label:s}))]}),e.jsx(d,{label:"Type",value:t.type,onChange:s=>a({type:s.target.value}),options:[{value:"all",label:"All types"},...L.map(s=>({value:s,label:s==="SECOND_HAND"?"Second Hand":"New"}))]}),e.jsx(h,{label:"Min price",type:"number",value:t.minPrice,onChange:s=>a({minPrice:s.target.value}),placeholder:"0"}),e.jsx(h,{label:"Max price",type:"number",value:t.maxPrice,onChange:s=>a({maxPrice:s.target.value}),placeholder:"500"})]})}function ae(){const t=O(),{user:a,isAuthenticated:n}=I(),{addToast:s}=k(),{filters:l,updateFilters:r,resetFilters:o,filteredListings:u,isListingsLoading:v,listingsError:b,currentPage:m,setCurrentPage:x,deleteListing:N}=A(),[f,y]=i.useState(l.query),j=z(f),{paginatedItems:S,totalPages:w,safePage:c}=B(u,m,6);if(i.useEffect(()=>{r({query:j})},[j]),i.useEffect(()=>{c!==m&&x(c)},[c,m,x]),b)return e.jsx(F,{title:"Unable to load listings",description:b});const C=p=>{t(`/listings/${p.id}/edit`)},P=async p=>{!window.confirm("Delete this listing? This action cannot be undone.")||!await N(p.id)||s({type:"success",message:"Listing deleted"})};return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("section",{className:"card-surface relative overflow-hidden bg-white/90 p-5 sm:p-6",children:[e.jsx("div",{className:"pointer-events-none absolute -right-24 -top-24 h-56 w-56 rounded-full bg-brand-100/70 blur-3xl"}),e.jsx("div",{className:"pointer-events-none absolute -left-16 bottom-0 h-40 w-40 rounded-full bg-cyan-100/70 blur-3xl"}),e.jsxs("div",{className:"relative",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-brand-700",children:"Verified Student Marketplace"}),e.jsx("h1",{className:"font-display mt-2 text-3xl font-extrabold tracking-tight text-slate-900 sm:text-4xl",children:"Find Great Deals Near Your Campus"}),e.jsxs("p",{className:"mt-2 max-w-2xl text-sm text-slate-600",children:["Default campus filter is set to ",e.jsx("strong",{children:l.campus}),". Search and narrow down listings instantly."]}),e.jsx("div",{className:"mt-4",children:e.jsx(G,{value:f,onChange:y})}),e.jsx("div",{className:"mt-4",children:e.jsx(M,{to:n?"/sell":"/login",className:"btn-primary",children:"Post an Item"})}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"rounded-full bg-brand-50 px-3 py-1 text-xs font-semibold text-brand-700",children:[u.length," listings"]}),e.jsxs("span",{className:"rounded-full bg-white px-3 py-1 text-xs font-semibold text-slate-600 shadow-sm",children:["Campus filter: ",l.campus]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-[300px_1fr]",children:[e.jsx(U,{filters:l,onChange:r,onReset:o}),e.jsxs(_.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.25},className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between rounded-2xl border border-brand-100/80 bg-white/80 px-4 py-3",children:e.jsxs("p",{className:"text-sm text-slate-600",children:["Showing ",e.jsx("strong",{children:u.length})," listings"]})}),e.jsx(R,{listings:S,loading:v,currentUser:a,onEditListing:C,onDeleteListing:P}),e.jsx(H,{currentPage:c,totalPages:w,onPageChange:x})]})]})]})}export{ae as default};
