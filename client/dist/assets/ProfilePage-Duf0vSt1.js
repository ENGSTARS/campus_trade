import{j as e,p as W,B as n,f as _,h as q,u as G,e as J,c as K,d as Q,r,C as N,q as R,l as X}from"./index-B1S_F-6_.js";import{u as Y,a as Z,p as ee}from"./validators-BqRfyaxh.js";import{B as se}from"./Badge-C6W-SCl_.js";import{C as g}from"./Card-DAcoRpIw.js";import{I as te}from"./Input-DYW_1lTB.js";import{S as ae}from"./Select-ysVb1C2v.js";import{M as le,R as ie}from"./ReviewModal-DlYS5sYH.js";import{E as re}from"./ErrorState-1quVR8lb.js";import{S as ne}from"./Skeleton-BK5u2klB.js";function ce({profile:t,onEdit:a,onAvatarUpload:d}){return e.jsxs("section",{className:"card-surface flex flex-col gap-4 p-5 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.avatar?e.jsx("img",{src:t.avatar,alt:t.fullName,className:"h-14 w-14 rounded-full object-cover"}):e.jsx("div",{className:"flex h-14 w-14 items-center justify-center rounded-full bg-brand-100 text-lg font-semibold text-brand-700",children:W(t.fullName)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold text-slate-900",children:t.fullName}),e.jsx("p",{className:"text-sm text-slate-600",children:t.email}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-slate-500",children:["Campus: ",t.campus]}),e.jsxs("span",{className:"badge-base bg-amber-100 text-amber-700",children:["Rating * ",t.rating]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("label",{className:"btn-secondary cursor-pointer",children:["Upload Photo",e.jsx("input",{className:"hidden",type:"file",accept:"image/*",onChange:d})]}),e.jsx(n,{variant:"secondary",onClick:a,children:"Edit Profile"})]})]})}function de({items:t,onReview:a,title:d="Transaction History"}){return e.jsxs(g,{children:[e.jsx("h3",{className:"mb-3 text-lg font-semibold text-slate-900",children:d}),e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-slate-500",children:[e.jsx("th",{className:"pb-2 pr-4",children:"Item"}),e.jsx("th",{className:"pb-2 pr-4",children:"Amount"}),e.jsx("th",{className:"pb-2 pr-4",children:"Status"}),e.jsx("th",{className:"pb-2",children:"Date"}),e.jsx("th",{className:"pb-2",children:"Action"})]})}),e.jsxs("tbody",{children:[t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-4 text-sm text-slate-500",children:"No records found."})}):null,t.map(l=>e.jsxs("tr",{className:"border-t border-slate-100",children:[e.jsx("td",{className:"py-2 pr-4 text-slate-700",children:l.item}),e.jsx("td",{className:"py-2 pr-4 text-slate-700",children:_(l.amount)}),e.jsx("td",{className:"py-2 pr-4",children:e.jsx(se,{label:l.status})}),e.jsx("td",{className:"py-2 text-slate-500",children:q(l.date)}),e.jsx("td",{className:"py-2",children:l.status==="Completed"&&a?e.jsx(n,{variant:"secondary",size:"sm",onClick:()=>a(l),children:"Review"}):null})]},l.id))]})]})})]})}function ge(){const t=G(),{listings:a,transactions:d,isTransactionsLoading:l,transactionsError:b,deleteListing:T,toggleWishlist:A}=J(),{user:o,setUser:D}=K(),{addToast:m}=Q(),[v,h]=r.useState(null),[I,y]=r.useState(!0),[w,S]=r.useState(""),[M,u]=r.useState(!1),[x,C]=r.useState(null),{register:f,handleSubmit:k,reset:P,formState:{errors:p,isSubmitting:L}}=Y({resolver:Z(ee),defaultValues:{fullName:"",bio:"",campus:N[0]}});r.useEffect(()=>{async function s(){y(!0),S("");try{const i=(await R.getProfile())?.user||null;h(i),P({fullName:i?.fullName||"",bio:i?.bio||"",campus:i?.campus||N[0]})}catch{S("Could not load profile")}finally{y(!1)}}s()},[P]);const j=r.useMemo(()=>a.filter(s=>s.sellerId===o?.id),[a,o]),O=r.useMemo(()=>d.filter(s=>s.buyerId===o?.id),[d,o]),E=r.useMemo(()=>a.filter(s=>s.isWishlisted&&s.sellerId!==o?.id),[a,o]),U=async s=>{const c=await R.updateProfile(s);h(c.user),D(c.user),u(!1),m({type:"success",message:"Profile updated"})},z=s=>{const c=s.target.files?.[0];if(!c)return;const i=new FileReader;i.onload=()=>{h(V=>({...V,avatar:i.result})),m({type:"success",message:"Profile photo updated"})},i.readAsDataURL(c)},B=async s=>{x&&(await X.submitReview(x.listingId||x.id,s),m({type:"success",message:`Review submitted for ${x.item}`}))},F=s=>{t(`/listings/${s}/edit`)},H=async s=>{!window.confirm("Delete this listing? This action cannot be undone.")||!await T(s)||m({type:"success",message:"Listing deleted"})},$=async s=>{await A(s)===!1&&m({type:"info",message:"Removed from saved"})};return I||l?e.jsx(ne,{className:"h-64 w-full"}):w||!v?e.jsx(re,{title:"Unable to load profile",description:w||"Please refresh and try again."}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(ce,{profile:v,onEdit:()=>u(!0),onAvatarUpload:z}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-[1fr_0.95fr]",children:[e.jsxs(g,{children:[e.jsx("h3",{className:"mb-3 text-lg font-semibold text-slate-900",children:"My Listings"}),e.jsxs("div",{className:"space-y-2",children:[j.map(s=>e.jsxs("div",{className:"rounded-xl border border-slate-100 p-3",children:[e.jsx("p",{className:"text-sm font-medium text-slate-800",children:s.title}),e.jsxs("p",{className:"text-xs text-slate-500",children:[s.campus," | ",s.status]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx(n,{variant:"secondary",size:"sm",onClick:()=>F(s.id),children:"Edit"}),e.jsx(n,{variant:"danger",size:"sm",onClick:()=>H(s.id),children:"Delete"})]})]},s.id)),j.length===0?e.jsx("p",{className:"text-sm text-slate-500",children:"No listings posted yet."}):null]}),e.jsxs("p",{className:"mt-3 text-xs text-slate-500",children:["Total posted: ",j.length]})]}),e.jsx(de,{title:"My Orders",items:O,onReview:C})]}),e.jsxs(g,{children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"My Saved"}),e.jsx(n,{variant:"secondary",size:"sm",onClick:()=>t("/saved"),children:"Open Saved"})]}),e.jsxs("div",{className:"space-y-2",children:[E.slice(0,4).map(s=>e.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-xl border border-slate-100 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-800",children:s.title}),e.jsx("p",{className:"text-xs text-slate-500",children:s.campus})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"secondary",size:"sm",onClick:()=>t(`/listings/${s.id}`),children:"View"}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>$(s.id),children:"Remove"})]})]},s.id)),E.length===0?e.jsx("p",{className:"text-sm text-slate-500",children:"No saved listings yet."}):null]})]}),b?e.jsx("p",{className:"text-sm text-rose-600",children:b}):null,e.jsx(le,{isOpen:M,onClose:()=>u(!1),title:"Edit Profile",children:e.jsxs("form",{className:"space-y-3",onSubmit:k(U),children:[e.jsx(te,{label:"Full Name",...f("fullName"),error:p.fullName?.message}),e.jsx(ae,{label:"Campus",...f("campus"),options:N.map(s=>({value:s,label:s})),error:p.campus?.message}),e.jsxs("label",{className:"flex flex-col gap-1.5 text-sm text-slate-700",children:[e.jsx("span",{className:"font-medium",children:"Bio"}),e.jsx("textarea",{className:"input-base min-h-24 resize-none",...f("bio"),placeholder:"Tell other students about yourself"}),p.bio?.message?e.jsx("span",{className:"text-xs text-rose-600",children:p.bio.message}):null]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(n,{variant:"secondary",onClick:()=>u(!1),children:"Cancel"}),e.jsx(n,{type:"submit",disabled:L,children:"Save Changes"})]})]})}),e.jsx(ie,{isOpen:!!x,onClose:()=>C(null),onSubmit:B})]})}export{ge as default};
