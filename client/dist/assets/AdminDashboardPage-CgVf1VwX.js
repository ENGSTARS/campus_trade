import{w as n,n as c,s as D,t as k,j as s,h as w,B as p,d as A,r as o}from"./index-B1S_F-6_.js";import{C as u}from"./Card-DAcoRpIw.js";import{B as g}from"./Badge-C6W-SCl_.js";import{E as C}from"./ErrorState-1quVR8lb.js";import{S as T}from"./Skeleton-BK5u2klB.js";const m={getStats(){return n(()=>c.get("/admin/stats"),{totalUsers:2480,activeListings:812,reportsOpen:16,ordersToday:31},{dedupeKey:"admin:stats"})},getReports(){return n(()=>c.get("/admin/reports"),{items:k},{dedupeKey:"admin:reports"})},getUsers(){return n(()=>c.get("/admin/users"),{items:D},{dedupeKey:"admin:users"})},suspendUser(t){return n(()=>c.post(`/admin/users/${t}/suspend`),{success:!0})},deleteUser(t){return n(()=>c.delete(`/admin/users/${t}`),{success:!0})},updateReportStatus(t,d){return n(()=>c.patch(`/admin/reports/${t}`,{status:d}),{success:!0,id:t,status:d})}};function E({stats:t}){const d=[{key:"totalUsers",label:"Total Users"},{key:"activeListings",label:"Active Listings"},{key:"reportsOpen",label:"Open Reports"},{key:"ordersToday",label:"Orders Today"}];return s.jsx("div",{className:"grid grid-cols-2 gap-3 lg:grid-cols-4",children:d.map(i=>s.jsxs(u,{className:"space-y-1",children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:i.label}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t?.[i.key]??0})]},i.key))})}function B({reports:t,onResolve:d,onDismiss:i}){return s.jsxs(u,{children:[s.jsx("h3",{className:"mb-3 text-lg font-semibold text-slate-900",children:"Reports"}),s.jsx("div",{className:"overflow-auto",children:s.jsxs("table",{className:"min-w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"text-left text-slate-500",children:[s.jsx("th",{className:"pb-2 pr-4",children:"Listing"}),s.jsx("th",{className:"pb-2 pr-4",children:"Reason"}),s.jsx("th",{className:"pb-2 pr-4",children:"Reported By"}),s.jsx("th",{className:"pb-2 pr-4",children:"Date"}),s.jsx("th",{className:"pb-2",children:"Status"}),s.jsx("th",{className:"pb-2",children:"Actions"})]})}),s.jsx("tbody",{children:t.map(e=>s.jsxs("tr",{className:"border-t border-slate-100",children:[s.jsx("td",{className:"py-2 pr-4 text-slate-700",children:e.listingTitle}),s.jsx("td",{className:"py-2 pr-4 text-slate-700",children:e.reason}),s.jsx("td",{className:"py-2 pr-4 text-slate-600",children:e.reportedBy}),s.jsx("td",{className:"py-2 pr-4 text-slate-500",children:w(e.createdAt)}),s.jsx("td",{className:"py-2",children:s.jsx(g,{label:e.status})}),s.jsx("td",{className:"py-2",children:s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsx(p,{variant:"secondary",size:"sm",onClick:()=>d?.(e.id),disabled:e.status==="Resolved"||e.status==="Dismissed",children:"Resolve"}),s.jsx(p,{variant:"ghost",size:"sm",onClick:()=>i?.(e.id),disabled:e.status==="Resolved"||e.status==="Dismissed",children:"Dismiss"})]})})]},e.id))})]})})]})}function L({users:t,onSuspend:d,onDelete:i}){return s.jsxs(u,{children:[s.jsx("h3",{className:"mb-3 text-lg font-semibold text-slate-900",children:"User Management"}),s.jsx("div",{className:"overflow-auto",children:s.jsxs("table",{className:"min-w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"text-left text-slate-500",children:[s.jsx("th",{className:"pb-2 pr-4",children:"Name"}),s.jsx("th",{className:"pb-2 pr-4",children:"Email"}),s.jsx("th",{className:"pb-2 pr-4",children:"Status"}),s.jsx("th",{className:"pb-2",children:"Actions"})]})}),s.jsx("tbody",{children:t.map(e=>s.jsxs("tr",{className:"border-t border-slate-100",children:[s.jsx("td",{className:"py-2 pr-4 text-slate-700",children:e.name}),s.jsx("td",{className:"py-2 pr-4 text-slate-600",children:e.email}),s.jsx("td",{className:"py-2 pr-4",children:s.jsx(g,{label:e.status})}),s.jsx("td",{className:"py-2",children:s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsx(p,{variant:"secondary",size:"sm",onClick:()=>d(e.id),children:"Suspend"}),s.jsx(p,{variant:"danger",size:"sm",onClick:()=>i(e.id),children:"Delete"})]})})]},e.id))})]})})]})}function P(){const{addToast:t}=A(),[d,i]=o.useState(null),[e,j]=o.useState([]),[R,h]=o.useState([]),[S,b]=o.useState(!0),[N,y]=o.useState("");o.useEffect(()=>{async function a(){b(!0),y("");try{const[r,l,x]=await Promise.all([m.getStats(),m.getReports(),m.getUsers()]);i(r),j(l?.items||[]),h(x?.items||[])}catch{y("Could not load admin dashboard")}finally{b(!1)}}a()},[]);const v=async a=>{await m.suspendUser(a),h(r=>r.map(l=>l.id===a?{...l,status:"Suspended"}:l)),t({type:"info",message:"User suspended"})},U=async a=>{await m.deleteUser(a),h(r=>r.filter(l=>l.id!==a)),t({type:"success",message:"User deleted"})},f=async(a,r)=>{await m.updateReportStatus(a,r),j(l=>l.map(x=>x.id===a?{...x,status:r}:x)),(r==="Resolved"||r==="Dismissed")&&i(l=>l&&{...l,reportsOpen:Math.max(0,Number(l.reportsOpen||0)-1)}),t({type:"success",message:`Report ${r.toLowerCase()}`})};return S?s.jsx(T,{className:"h-72 w-full"}):N?s.jsx(C,{title:"Admin dashboard unavailable",description:N}):s.jsxs("div",{className:"space-y-4",children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Admin Dashboard"}),s.jsx(E,{stats:d}),s.jsx(B,{reports:e,onResolve:a=>f(a,"Resolved"),onDismiss:a=>f(a,"Dismissed")}),s.jsx(L,{users:R,onSuspend:v,onDelete:U})]})}export{P as default};
